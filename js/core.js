define("/DigiShell/js/core",["./logo","backbone/backbone/1.1.0/backbone","jquery","backbone/underscore/1.5.2/underscore","./util","./router","./widgets","./sidebar","./theme"],function(a){a("./logo");var b=a("./util"),c=a("./router"),d=a("./widgets"),e=a("./sidebar"),f=a("./theme");return $(function(){$(".user-name").text(function(a){for(var b,c=a.split(" "),d=0;b=c[d];d++)c[d]=b.charAt(0).toUpperCase()+b.slice(1);return c.join(" ")}(b.getUserName()||b.getUserId()))}),{util:b,router:c,widgets:d,sidebar:e,theme:f}}),define("/DigiShell/js/logo",["backbone/backbone/1.1.0/backbone","jquery","backbone/underscore/1.5.2/underscore"],function(a){function b(a){f.isExpan=!f.isExpan,$(".navbar-banner-control").toggleClass("navbar-banner-control-collapse").find("i").get(0).className="icon-caret-"+(f.isExpan?"up":"down"),c(),$(".navbar-banner").slideToggle(this.speed,function(){f.trigger("change:isExpan")}),a&&a.preventDefault()}function c(){var a=$(".main-content .page-content");a.css("min-height",screen.availHeight-a.offset().top+"px")}var d=a("backbone/backbone/1.1.0/backbone"),e=a("backbone/underscore/1.5.2/underscore"),f=e.extend({speed:500,delay:5e3,height:$(".navbar-banner").height(),isExpan:!0},d.Events),g=function(){var a;return function(){a&&clearTimeout(a),a=setTimeout(function(){$(window).scrollTop()>100?$("#btn-scroll-up").fadeIn(150):$("#btn-scroll-up").fadeOut(150)},50)}}();return $(".navbar-banner-control a").click(b),$(function(){c(),$(window).scroll(g)}),f}),define("/DigiShell/js/router",["backbone/backbone/1.1.0/backbone","jquery","backbone/underscore/1.5.2/underscore","./widgets","./util","./sidebar"],function(a){function b(a,b){var c=[{href:b.get("href"),name:b.get("name")}];for(b=a.get(b.get("parentId"));b&&"root"!==b.id;)c.push({href:b.get("href"),name:b.get("name")}),b=a.get(b.get("parentId"));return c.push({id:"root",href:"#",name:"首页"}),c}var c=a("backbone/backbone/1.1.0/backbone"),d=a("backbone/underscore/1.5.2/underscore"),e=a("./widgets"),f=a("./sidebar"),g=c.Router.extend({initialize:function(){$(function(){c.history.start()})},routes:{"":"openHome","widget_:id":"openWidget","m_:id":"openMenu","m_:id/:itemId":"openMenuItem","m_:id/:itemId/a_:appItemId":"openAppMenuItem","m_:id/:itemId/q_:queryId":"openQuery",config:"openConfig"},openHome:function(){e.initWidget(),f.activeMenu(),$(".page-content >.active").removeClass("active"),$(".page-content .widgetContent").addClass("active"),$("#breadcrumbs .breadcrumb").html('<li class="active"><i class="icon-home home-icon"></i>首页</li>'),document.title="首页 - BEIJING-FANUC"},openWidget:function(a){var b=this;f.activeMenu(),e.initWidget(null,function(){var c=a.split("_"),f=c[0],g=c[1],h=e.byId(f);b.makeBreadcrumb([{href:"#widget_"+f+(g?"_"+g:""),name:g?d.find(h.tabs,function(a){return a.id===g}).name.replace(/<.+>(\S*)<\/.+>/g,"$1"):h.title.replace(/<.+>(\S*)<\/.+>/g,"$1")},{id:"root"}],"widget"),h.open(g)})},openMenu:function(b){var c;if(c=/^(\S+)\?more/.exec(b)){this.makeBreadcrumb([{name:"hotForm"===c[1]?"所有申请":"所有应用",href:b},{id:"root"}],"more");var d=c[1];return a.async("./siteMap",function(a){$(".page-content >.active").removeClass("active");var b=$(".page-content .siteMap").addClass("active").children().hide(),c=b.filter("."+d).show();a.getSiteMap(d,{el:c[0]})}),f.openMenu(d)}return f.openMenu(b)},openMenuItem:function(a,c){var d=this.openMenu(a);d.getItem(c,function(c,e){digishell.router.makeBreadcrumb(b(e,c),"m_"+a),d.openItem(c)})},openAppMenuItem:function(a,c,d){var e=this;f.getMenu(a).getItem(c,function(g,h){g&&(e.makeBreadcrumb(b(h,g),"m_"+a),f.openMenu("app").setSource({from:"#m_"+a+"/"+c,dbPath:g.get("dbPath"),view:g.get("view"),source:g.get("source")||"MenusListForm?OpenForm"}).getItem(d,function(a){this.openItem(a)}))})},openQuery:function(c,e,g){var h=this;f.getMenu(c).getItem(e,function(i,j){h.makeBreadcrumb(b(j,i),"m_"+c);var k=f.openMenu("app");k.setSource({from:"#m_"+c+"/"+e,dbPath:i.get("dbPath"),view:i.get("view"),source:i.get("source")||"MenusListForm?OpenForm"}),a.async(["./viewFrame","./databaseQuery"],function(a,b){a.set({queryFrame:b,view:d.extend(a.get("view"),{dbPath:i.get("dbPath")})}),b.getQueryNames(i.get("dbPath"),function(a){h.makeBreadcrumb([{name:a[g].name},{name:"查询"},{id:"root"}],"APP"),b.loadQuery(i.get("dbPath"),g)})})})},openConfig:function(){var b=this;b.makeBreadcrumb([{name:"个人设置",href:"#config"},{id:"root"}],"config"),$(".page-content >.active").removeClass("active"),$(".page-content .config").addClass("active"),a.async("./config",function(a){a.init()})},makeBreadcrumb:function(a,b){var c=[],d="首页",e=a[0],f=1;if("APP"!==b){for(c.push("<li class='active'>"+e.name+"</li>"),d=e.name;(e=a[f++])&&"root"!==e.id;)c.push("<li><a href='#"+b+"'>"+e.name+"</a><span class='divider'><i class='icon-angle-right arrow-icon'></i></span></li>");c.push("<li><i class='icon-home home-icon'></i><a href='#'>首页</a><span class='divider'><i class='icon-angle-right arrow-icon'></i></span></li>")}else{for(d=e.name,c.push("&nbsp;"+e.name+"</small></h1>");(e=a[f++])&&"root"!==a[f].id;)c.push("&nbsp;"+e.name+"&nbsp;<i class='icon-double-angle-right'></i>");c.push("<h1>"+e.name+"&nbsp;<small><i class='icon-double-angle-right'></i>")}if("APP"!==b)$("#breadcrumbs .breadcrumb").html(c.reverse().join("")),document.title=d+" - BEIJING-FANUC";else{var g=document.title.split(" - ");$(".view-breadcrumb").html(c.reverse().join("")),document.title=d+" - "+(g.length>2?g.slice(1):g).join(" - ")}}}),h=new g;return h}),define("/DigiShell/js/sidebar",["backbone/backbone/1.1.0/backbone","jquery","backbone/underscore/1.5.2/underscore","./util"],function(require,exports){function convertItemsToBreadcrumb(a,b){var c=[{href:b.get("href"),name:b.get("name")}];for(b=a.get(b.get("parentId"));b&&"root"!==b.id;)c.push({href:b.get("href"),name:b.get("name")}),b=a.get(b.get("parentId"));return c.push({id:"root",href:"#",name:"首页"}),c}function convertIconClassName(a){switch(a){case"create":case"/DF_Res/DF_Img_Source/Img_KJ/create.gif":return"icon-file-alt";case"draft":case"/DF_Res/DF_Img_Source/Img_KJ/draft.gif":return"icon-save";case"doing":case"/DF_Res/DF_Img_Source/Img_KJ/doing.gif":return"icon-rocket";case"done":case"/DF_Res/DF_Img_Source/Img_KJ/done.gif":return"icon-flag";case"my":case"/DF_Res/DF_Img_Source/Img_KJ/my.gif":return"icon-user";case"all":case"/DF_Res/DF_Img_Source/Img_KJ/all.gif":return"icon-hdd"}return a||""}var Backbone=require("backbone/backbone/1.1.0/backbone"),_=require("backbone/underscore/1.5.2/underscore"),util=require("./util"),renderDeep=null,click_event=$.fn.tap?"tap":"click",itemTemplate=_.template("<li><a href='<%=href%>'><i class='<%=ico||(level===2?\"icon-double-angle-right\":\"\")%>'></i><span class='menu-text'><%=name%></span></a></li>"),parentTemplate=_.template("<li><a href='<%=href%>' class='dropdown-toggle <%=obj.lazy?'lazy':''%>'><i class='<%=ico||(level===2?\"icon-double-angle-right\":\"\")%>'></i><span class='menu-text'><%=name%></span><b class='arrow icon-angle-down'></b></a><ul class='submenu'><%=childItem%></ul></li><% delete obj.childItem %>"),menuOptChecker=/GJOpt_ViewTmpGotoURL\('\S+?&login(\S+?)'\)/,menuCache={},moduleCache={},isMiniMenu,BaseMenuItems=Backbone.Collection.extend({type:"",source:null,initialize:function(a,b){this.type=b?b.type||"":null,this.forForm=b?b.forForm:!1},model:Backbone.Model.extend({id:"",ico:"",name:"",server:"",dbPath:"",view:"",url:"",opt:"",parentId:""}),getItem:function(a,b){var c=this.get(a);return c?(_.isFunction(b)&&b.call(this,c,this),void 0):(this.listenToOnce(this,"add",function(){this.getItem(a,b)}),void 0)},openItem:function(item,event){var _this=this,openLink=function(){return item.get("url")?(window.open(item.get("url"),"_blank"),!0):item.get("opt")&&null===menuOptChecker.exec(item.get("opt"))?(eval("("+item.get("opt")+")"),!0):item.get("form")?(void 0===item.get("source")||-1!==item.get("source").indexOf(".xsp")?window.open("/"+item.get("dbPath")+"/"+item.get("form")+".xsp","_blank"):window.open("/"+item.get("dbPath")+"/"+item.get("form")+"?openform","_blank"),!0):!1},openView=function(){if(item.get("view")){var a=openMenu("app"),b={from:"#m_"+_this.type+"/"+item.id,dbPath:item.get("dbPath"),view:item.get("view"),source:item.get("source")||"MenusListForm?OpenForm",stamp:new Date};return item.get("server")&&(b.server=item.get("server")),a.setSource(b),!0}return!1},flag=this.forForm?openLink()||openView():openView()||openLink();event&&event.preventDefault()}}),AppMenuItems=BaseMenuItems.extend({source:null,activeItem:null,setSource:function(a){this.source=this.source||{};var b=_.clone(this.source);return _.isEqual(b,_.extend(this.source,a))||(this.isXsp=-1!==a.source.indexOf(".xsp"),this.loadItems(function(){this.source.stamp?this.openDefaultItem():this.activeDefaultItem()})),this},loadItems:function(a){var b=this;this.source.server||this.fetch(_.extend(this.isXsp?{}:{dataType:"text"},{url:"/"+this.source.dbPath+"/"+this.source.source,reset:!0,success:function(){_.isFunction(a)&&a.apply(b)},error:function(a,b,c){if(0===b.responseText.indexOf("<!DOCTYPE HTML PUBLIC")&&-1!==b.responseText.indexOf('<input name="RedirectTo" value="'+c.url+'" type=hidden>')){var d=/<span id="ReasonTextInfo">(\S+?)<\/span>/.exec(b.responseText);digishell.util.openLogin(d?d[1]:"")}}}))},getItem:function(a,b){var c=this,d=this.get(a);return d?(_.isFunction(b)&&b.call(c,d,c),void 0):(this.loadItems(function(){_.isFunction(b)&&(d=this.get(a),b.call(c,d,c))}),void 0)},openItem:function(a,b){var c=this;a.get("view")?(this.activeItem=a.id,this.trigger("change:activeItem",a),require.async("./viewFrame",function(b){digishell.router.makeBreadcrumb(convertItemsToBreadcrumb(c,a),"APP"),b.openView(a.attributes)})):BaseMenuItems.prototype.openItem.apply(this,[a,b])},openDefaultItem:function(){var a=this.where({view:this.source.view})[0];a&&digishell.router.navigate(this.source.from+"/a_"+a.id,{replace:!1,trigger:!0})},activeDefaultItem:function(){var a=this.where({view:this.source.view})[0];a&&(this.activeItem=a.id,this.trigger("change:activeItem",a))},parse:function(a,b){var c=this,d=[{id:"root",level:0}],e=function(a,b){var c=this,d=function(a){var b={};return _.forEach(a.split("&"),function(a){var c,d,e=a.indexOf("=");-1!==e?(c=a.substring(0,e),d=a.substring(e+1)):c=a,"count"!==c&&(b[c]=d)}),b.thDir&&b.thDb&&(b.dbPath=b.thDir+"/"+b.thDb,delete b.thDir,delete b.thDb),b.thView&&(b.view=b.thView,delete b.thView),b.draftflag&&(b.draft=!0,delete b.draftflag),b.page&&(b.page=parseInt(b.page)),b},f=[];return a.each(function(a){var g,h=$(this),i={id:h.attr("id")||("root"===b?"":b+"_")+a,name:h.attr("name"),ico:convertIconClassName(h.attr("ico")),lazy:!!h.attr("lazy"),parentId:b},j=h.children();"0"===i.id&&h.attr("lazySource")&&(c.url=h.attr("lazySource")),null!==(g=menuOptChecker.exec(h.attr("opt")))?_.extend(i,d(g[1])):i.opt=h.attr("opt"),f.push(i),j.size()>0&&(f=f.concat(e(j,i.id)))}),f};if("text"===b.dataType){var f=/.+<[Tt][Ee][Xx][Tt][Aa][Rr][Ee][Aa] id="MenuXmlList" style="display:none">(.+?)<\/[Tt][Ee][Xx][Tt][Aa][Rr][Ee][Aa]>.*/.exec(a.replace(/\n|\r/g,""))[1].replace(/&/g,"&amp;");d=d.concat(e($($.parseXML(f).firstChild).children(),"root"))}else{var g=function(b,d){var e=[];return"lazySource"in a&&(c.url=a.lazySource),_.each(b,function(a,b){e.push(_.extend(a,{id:a.id||("root"===d?"":d+"_")+b,ico:convertIconClassName(a.ico),dbPath:h,parentId:d,lazy:!!a.lazy})),"showDraftDel"in a&&(a.draft=!0,delete a.showDraftDel),a.children&&(e=e.concat(g(a.children,a.id)),delete a.children)}),e},h=/\/(\S+)\/\S*/.exec(b.url)[1];d=d.concat(g(a.items,"root"))}return d}}),SiteMapSource=BaseMenuItems.extend({url:function(){return"/Produce/DigiShell.nsf/getMenuDataXAgent.xsp?parent=root"},getItem:function(a,b){var c=this.get(a),d=this;return c?(_.isFunction(b)&&b.call(this,c,this),void 0):(this.fetch({success:function(){c=d.get(a),_.isFunction(b)&&b.call(d,c,d)},error:function(a,b,c){0===b.responseText.indexOf("<!DOCTYPE HTML PUBLIC")&&-1!==b.responseText.indexOf('<input name="RedirectTo" value="'+c.url+'" type=hidden>')&&digishell.util.openLogin()}}),void 0)}}),BaseMenu=Backbone.View.extend({tagName:"ul",className:"nav nav-list",model:null,activeItemNode:null,events:$.fn.tap?{"tap a":"sideMenuClick"}:{"click a":"sideMenuClick"},initialize:function(){var a=this,b=util.localConfig(this.id+"Config"),c=function(b){this.model.add(b),this.render("root"),"eval_callback"in window&&this.$el.find("a").click(function(b){a.sideMenuClick.call(a,b)})};$("#"+this.id+"Menu").append(this.el),this.model=new BaseMenuItems([],{type:this.id,forForm:-1!==this.id.indexOf("Form")}),b?c.call(this,b):require.async("./defaultConfig",function(b){c.call(a,b.DEFAULT_MENU[a.id])})},sideMenuClick:function(a){var b=$(a.currentTarget),c=this;if(b&&0!==b.length){if(!b.hasClass("dropdown-toggle")){if(isMiniMenu&&"tap"===click_event&&b.get(0).parentNode.parentNode===this.el){var d=b.find(".menu-text").get(0);if(a.target!==d&&!$.contains(d,a.target))return!1}return this.model.openItem(this.getItemByLink(b),a),void 0}if(b.hasClass("lazy")){var e=this.getItemByLink(b);this.model.sync("read",this.model,{data:{parentId:e.id},success:function(a){c.model.add(_.map(a,function(a,b){return a.id=a.id||e.id+"_"+b,a.ico=a.ico||"",a.dbPath=c.source.dbPath,a.lazy=!!a.lazy,a.parentId=e.id,a})),c.render(e.id),b.removeClass("lazy"),e.set("lazy",!1)}}),a.preventDefault()}a.preventDefault();var f=b.next().get(0);if(!$(f).is(":visible")){var g=$(f.parentNode).closest("ul");if(isMiniMenu&&g.hasClass("nav-list"))return;g.find("> .open > .submenu").each(function(){this===f||$(this.parentNode).hasClass("active")||$(this).slideUp(200).parent().removeClass("open")})}return isMiniMenu&&$(f.parentNode.parentNode).hasClass("nav-list")?!1:($(f).slideToggle(200).parent().toggleClass("open"),void 0)}},getItemByLink:function(a){return this.model.get(/#\S+\/(\S+)/.exec(a.attr("href"))[1])},getLinkById:function(a){return this.$el.find("[href='#m_"+this.id+"/"+a+"']")},activateItem:function(a){var b=this.getLinkById(a.id);this.activeItemNode&&this.activeItemNode.removeClass("active").removeClass("open"),b.parent("li").parents("li").addClass("open"),this.activeItemNode=b.parents("li").addClass("active")},getMenuNode:function(a){var b="",c=this.model.get(a).get("level")+1,d=this.model.where({parentId:a});if(d.length>0)for(var e,f=0;e=d[f++];)e.set("level",c),b+=this.model.findWhere({parentId:e.id})||e.get("lazy")?parentTemplate(_.extend({href:this.getHref(e),childItem:renderDeep&&c>renderDeep?"":this.getMenuNode(e.id)},e.attributes)):itemTemplate(_.extend(e.attributes,{href:this.getHref(e)}));return b},getHref:function(a){return"#m_"+this.id+"/"+a.id},render:function(a){return("root"!==a?this.$el.find("a.dropdown-toggle[href='"+this.getHref({id:a})+"']").parent().find(".submenu"):this.$el).empty().append(this.getMenuNode(a)),this.trigger("rendered"),this}});moduleCache.hotForm=BaseMenu.extend({id:"hotForm",initialize:function(){BaseMenu.prototype.initialize.apply(this,arguments)}}),moduleCache.hotApp=BaseMenu.extend({id:"hotApp",initialize:function(){BaseMenu.prototype.initialize.apply(this,arguments)}}),moduleCache["switch"]=BaseMenu.extend({id:"switch"}),moduleCache.app=BaseMenu.extend({id:"app",source:null,isXsp:!1,initialize:function(){var a=this;this.model=new AppMenuItems([],{type:this.id}),$("#appMenu").append(this.el),this.listenTo(this.model,"reset",function(){a.render("root"),"eval_callback"in window&&this.$el.find("a").click(function(b){a.sideMenuClick.call(a,b)})}),this.listenTo(this.model,"change:activeItem",function(b){_.defer(function(){a.activateItem(b)})})},getItemByLink:function(a){return this.model.get(/#\S+\/a_(\S+)/.exec(a.attr("href"))[1])},getLinkById:function(a){return this.$el.find("[href='"+this.model.source.from+"/a_"+a+"']")},getHref:function(a){return this.model.source.from+"/a_"+a.id}}),moduleCache.siteMap=BaseMenu.extend({id:"siteMap",initialize:function(){this.model=new SiteMapSource([],{type:this.id})}});var getMenu=function(a,b){var c=menuCache[a]?menuCache[a]:menuCache[a]=new moduleCache[a](b);return c.model},activeMenu=function(a){var b=a||getMenu("hotForm");return $("#sidebar-shortcuts-large a[href='#"+b.type+"Menu']").tab("show"),b},slideSwitch=function(a,b){a.hide(),b.show()},openMenu=function(a){return activeMenu(getMenu(a))};$(function(){$("#menu-toggler").on(click_event,function(){return $("#sidebar").toggleClass("display"),$(this).toggleClass("display"),!1}),$("#sidebar-shortcuts").children().on("show",function(a){$(a.currentTarget).find(".active").removeClass("active"),$(a.target).addClass("active"),getMenu($(a.target).attr("href").replace(/Menu|#/g,""))}),$("#sidebar-collapse").on(click_event,function(){isMiniMenu=!$("#sidebar").hasClass("menu-min"),ace.settings.sidebar_collapsed(isMiniMenu)})}),exports.activeMenu=activeMenu,exports.slideSwitch=slideSwitch,exports.getMenu=getMenu,exports.openMenu=openMenu}),define("/DigiShell/js/util",["backbone/underscore/1.5.2/underscore","backbone/backbone/1.1.0/backbone","jquery"],function(a,b){var c=a("backbone/underscore/1.5.2/underscore"),d=a("backbone/backbone/1.1.0/backbone"),e=function(){var a={};return $.ajax({url:"/Produce/DigiShell.nsf/personalInfoXAgent.xsp",type:"GET",async:!1,cache:!1,dataType:"json"}).success(function(b){a=b,"sessionStorage"in window&&(sessionStorage.setItem("userId",a.userId),sessionStorage.setItem("userName",a.userName))}).error(function(a){if(403!==a.status)throw"获取个人配置数据错误！";location.href="/names.nsf?login"}),a}(),f=d.View.extend({callback:null,handle:null,className:"alert digishell fade in",template:c.template('<a href="#" class="close" data-dismiss="alert">&times;</a><strong><i class="<%=ico%>"></i><%=title%></strong>&nbsp;&nbsp;<%=text%>'),initialize:function(){this.$el.on("closed",function(){c.isFunction(this.callback)&&this.callback()})},show:function(a){a=c.extend({ico:"icon-exclamation-sign",title:"",text:"",autoClose:!0},a);var b=this.$el;this.callback=a.callback,b.removeClass((b.attr("class").match(/alert-\S+/)||[]).join(" ")),c.isString(a.className)&&b.addClass(a.className),b.html(this.template(a)).addClass("in").appendTo("body").alert(),this.handle&&clearTimeout(this.handle),a.autoClose&&(this.handle=setTimeout(function(){b.alert("close")},c.isNumber(a.autoClose)?parseInt(a.autoClose):3e3))}}),g=f.extend({callback:null,template:c.template('<a href="#" class="close" data-dismiss="alert">&times;</a><h4><i class="<%=ico%>"></i><%=title%></h4><p><%=text%></p><p><a class="btn btn-small btn-danger sure" href="#">确定</a>&nbsp;<a class="btn btn-small cancel">取消</a></p>'),events:{"click a.btn":function(a){if(c.isFunction(this.callback)){var b=$(a.currentTarget).hasClass("sure");this.callback(b),this.$el.alert("close")}a.preventDefault()}}});b.getObject=function(a,b){for(var c,d=b||window,e=a.split("."),f=0;d&&(c=e[f]);f++)d=c in d?d[c]:void 0;return d},b.getUserId=function(){var a="sessionStorage"in window?sessionStorage.getItem("userId"):null,b=/.*?userId=(\S+?)(?:;.*|$)/;return function(){if(a)return a;var c=b.exec(document.cookie);return c?a=c[1]:"anonymous"}}(),b.getUserName=function(){var a="sessionStorage"in window?sessionStorage.getItem("userName"):null,b=/.*?userName=(\S+?)(?:;.*|$)/;return function(){if(a)return a;var c=b.exec(document.cookie);return c?a=c[1]:"匿名用户"}}(),b.getUserLanguage=function(){var a="";return function(){return a||function(){return a=window.navigator.language||window.navigator.userLanguage,a.replace(/_/,"-").toLowerCase(),a.length>3&&(a=a.substring(0,3)+a.substring(3).toUpperCase()),a}()}}(),b.localConfig=function(){var a,c="digishell_config_"+b.getUserId();return function(b,d){return a||(a=JSON.parse(localStorage.getItem(c)),a||(a=function(){var a={};return e.configLastModify&&$.ajax({url:"/Produce/DigiShell.nsf/personalInfoXAgent.xsp",type:"GET",async:!1,dataType:"json"}).success(function(b){a=b}).error(function(){throw alert("ERROR"),"获取个人配置数据错误！"}),a}())),"object"==typeof b?(localStorage.setItem(c,JSON.stringify($.extend(a,b))),a):"undefined"!=typeof b&&"undefined"!=typeof d?(a[b]=d,localStorage.setItem(c,JSON.stringify(a)),a):b?a[b]:a}}(),b.saveLocalConfig=function(){var a={},c=b.localConfig();for(var d in c)a[d]=JSON.stringify(c[d]);return $.post("Produce/DigiShell.nsf/personalConfigXAgent.xsp",a,function(){},"json"),a},b.openLogin=function(a){var b=location.href.substring(location.href.indexOf(location.host)+location.host.length),c=$(".login");c.find("form input[name='RedirectTo']").val(b),a?c.find(".login-info").text(a).show():c.find(".login-info").hide(),c.modal()},b.notify=function(){var a=new f;return function(b){a.show(b)}}(),b.confirmNotify=function(){var a=new g;return function(b){a.show(c.extend({autoClose:!1},b))}}(),b.alert=void 0,b.confirm=void 0}),define("/DigiShell/js/theme",["./util","backbone/underscore/1.5.2/underscore","backbone/backbone/1.1.0/backbone","jquery","./widgets"],function(a,b){var c=a("./util"),d=a("./widgets"),e={company:{editable:!1,widgets:d.DEFAULT_WIDGET},personal:{widgets:c.localConfig("widgetsConfig")||[{id:"widget_rwxx",wId:"RWXX",col:4,row:1,size_x:3,size_y:2},{ico:"icon-calendar",id:"DF_A_A_09",name:"工作日历",parentId:"DF_A_A",wId:"shortcut",size_x:1,size_y:1,col:3,row:1},{ico:"icon-globe",id:"mylanguage",name:"个人语言",parentId:"DF_A_A",wId:"shortcut",size_x:1,size_y:1,col:2,row:1},{ico:"icon-user",id:"Menu_PsnInfo",name:"通讯录",parentId:"DF_A_A",wId:"shortcut",size_x:1,size_y:1,col:2,row:2},{ico:"icon-comments-alt",id:"MeetingManage",name:"会议室管理",parentId:"DF_A_C",wId:"shortcut",size_x:1,size_y:1,col:3,row:2},{ico:"icon-ticket",id:"DF_A_GZXZ",name:"工作交办",parentId:"DF_A_C",wId:"shortcut",size_x:1,size_y:1,col:1,row:2},{ico:"icon-pencil",id:"DF_A_C_01",name:"办公用品管理",parentId:"DF_A_C",wId:"shortcut",size_x:1,size_y:1,col:1,row:1},{id:"widget_weather",wId:"weather",size_x:3,size_y:1,parentId:"widget",col:4,row:3}]}};b.switchConfig=function(a){var b=e[a];b.widgets&&(digishell.widgets.destory(),b.editable!==!1&&c.localConfig("widgetsConfig",b.widgets),digishell.widgets.initWidget(b.widgets),digishell.router.navigate("#",!0))}}),define("/DigiShell/js/widgets",["backbone/backbone/1.1.0/backbone","jquery","backbone/underscore/1.5.2/underscore","./util"],function(a,b){function c(a,d,e){var f;$.each(a,function(a,g){switch(g.type){case"v":f=$("<div class='span"+12/(e/g.size_x)+" widget-container-span'></div>");break;case"h":f=$("<div class='row-fluid'></div>"),d.children().size()>0&&d.append("<div class='space-6'></div>");break;case"w":var h=b.getWidget(g.wId,g);d.append(h.el);break;default:f=$("<div>")}g.children&&c(g.children,f,"v"===g.type?g.size_x:e),d.append(f)})}function d(a){var b={};return f.each(a||i,function(c){var d=a?c:c.singleton===!1?c.id:c.widgetId;b[d]=i[d].source}),b}var e=a("backbone/backbone/1.1.0/backbone"),f=a("backbone/underscore/1.5.2/underscore"),g=a("./util"),h={},i={},j=[],k=!1;b.DEFAULT_WIDGET=[{id:"widget_gsxw",wId:"gsxw",col:1,row:1,size_x:3,size_y:2},{id:"widget_rwxx",wId:"RWXX",col:4,row:1,size_x:3,size_y:2}],b.addWidget=function(a,b){return h[b.widgetId]=a?h[a].extend(f.extend(b,{events:f.extend({},h[a].prototype.events,b.events)})):e.View.extend(b),this},b.addCallback=function(a){j.push(a)},b.startup=function(a){return c(a,$(".widgetContent").empty(),6),this},b.render=function(a,b){var c=d(a);return $.post("/Produce/DigiShell.nsf/HomeDataServiceXAgent.xsp",{define:JSON.stringify(c)},function(d){var e=f.isFunction(b)?b(a,d):!0;if(e!==!1)for(var g in c)i[g].render(d[g]);f.each(j,function(a){a(d)})},"json"),this},b.byId=function(a){return i[a]},b.loadWidget=function(b,c){f.isArray(b)&&f.each(b,function(){}),a.async("./widgets-add-on",c)},b.getWidget=function(a,b){var c=h[a];if(c.prototype.singleton===!1){var d=new c(b);return i[d.id]=d}return i[a]?i[a]:i[a]=new c(b)},b.destory=function(a){if(a);else{$(".widgetContent").empty();for(var b in i)i[b].$el.remove(),delete i[b];k=!1}},b.initWidget=function(a,c){function d(a,b){var c="col"===b,e=c?"size_x":"size_y",g=c?"v":"h";if(a.length>1){var h=[];return f.chain(a).groupBy(b).each(function(a){var d,i=f.max(a,function(a){return a[e]});(d=f.find(h,function(a){return a[b]<i[b]&&a[b]+a[e]>i[b]}))?(i[b]+i[e]>d[b]+d[e]&&(d[e]=d[e]+i[e]-i[b]),d.children=d.children.concat(a)):h.push(f.extend({type:g,children:a},c?{col:a[0].col,size_x:i.size_x}:{row:a[0].row,size_y:i.size_y}))}),f.chain(h).map(function(a){return a.children=d(a.children,c?"row":"col"),a}).sortBy(b).value()}return f.chain(a).map(function(a){return f.extend({},a,{type:"w"})}).sortBy(b).value()}b.loadWidget("",function(){k||(b.startup(d(a||g.localConfig("widgetsConfig")||b.DEFAULT_WIDGET,"col")),b.render(),k=!0),f.isFunction(c)&&c()})}});